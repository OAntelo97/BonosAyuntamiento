@page "/usuarios"
@inject NavigationManager Navigate
@using BonosAyto.Components.Pages.Usuarios
@using BonosAytoService.DTOs
@using BonosAyto.Components.DataTables
@using BonosAyto.Components.Templates
@using BonosAyto.Components.Enums;



<PlantillaListadoAlta tipo="PageType.Usuarios">
    <renderAlta>
        <EditForm Model="usuario" OnValidSubmit="@GuardarUsuario">
            <DataAnnotationsValidator />
            <div class="mb-3">
                <label for="usuario" class="form-label">Usuario</label>
                <InputText id="usuario" @bind-Value="usuario.Usuario" class="form-control" placeholder="Usuario" required />
            </div>
            <div class="mb-3">
                <label for="pass" class="form-label">Contraseña</label>
                <InputText type="password" id="pass" @bind-Value="usuario.Pass" class="form-control" placeholder="Contraseña" required />
            </div>
            <div class="mb-3">
                <label for="rol" class="form-label">Rol</label>
                <InputSelect id="rol" @bind-Value="usuario.Rol" class="form-select" required>
                    <option value="" selected>-- Selecciona un Rol --</option>
                    <option value="G">Gestión</option>
                    <option value="C">Control</option>
                    <option value="S">Servicio</option>
                </InputSelect>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <InputText id="email" @bind-Value="usuario.Email" class="form-control" placeholder="Email" />
                <ValidationMessage For="@(() => usuario.Email)" />
            </div>
            @if (usuario?.Rol == 'S')
            {
                <div class="mb-3">
                    <label for="IdEstablecimiento" class="form-label">Establecimiento</label>
                    <InputSelect id="IdEstablecimiento" @bind-Value="usuario.IdEstablecimiento" class="form-select">
                        <option value="">-- Selecciona --</option>
                        @foreach (var establecimiento in establecimientos)
                        {
                            <option value="@establecimiento.Id">@establecimiento.Nombre</option>
                        }
                    </InputSelect>
                </div>
            }
            <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">Guardar usuario</button>
            </div>
        </EditForm>
    </renderAlta>

    <renderListado>
        <DataTables>
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Nombre</th>
                        <th>Email</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var usuario in usuarios)
                    {
                        <tr>
                            <td>@usuario.Usuario</td>
                            <td>@usuario.Email</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-info me-1" @onclick="@(() => VerDetalle(usuario.Id))">
                                    <i class="bi bi-search" title="Ver detalles"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning me-1" @onclick="@(() => Editar(usuario.Id))">
                                    <i class="bi bi-pencil" title="Editar campos"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" @onclick="@(() => Eliminar(usuario.Id))">
                                    <i class="bi bi-trash" title="Eliminar usuario"></i>
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </DataTables>
    </renderListado>
</PlantillaListadoAlta>
