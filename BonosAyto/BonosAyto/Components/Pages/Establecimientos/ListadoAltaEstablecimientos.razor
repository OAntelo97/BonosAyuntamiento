@page "/establecimientos"
@using BonosAytoService.DTOs
@inject NavigationManager Navigate
@using BonosAyto.Components.Templates
@using BonosAyto.Components.Enums
@* @attribute [Authorize] *@

<ListadoAltaTemplate tipo="PageType.Establecimientos">
    <renderAlta>
        <EditForm Model="establecimiento" OnValidSubmit="@GuardarEstablecimiento">
            <DataAnnotationsValidator />

            <label for="nombre">Nombre</label>
            <InputText id="nombre" @bind-Value="establecimiento.Nombre" class="form-control" />
            <ValidationMessage For="@(() => establecimiento.Nombre)" />

            <label for="dni" class="mt-3">NIF</label>
            <InputText id="dni" @bind-Value="establecimiento.NIF" class="form-control" />
            <ValidationMessage For="@(() => establecimiento.NIF)" />

            <label for="direccion" class="mt-3">Dirección</label>
            <InputText id="direccion" @bind-Value="establecimiento.Direccion" class="form-control" />

            <label for="cp" class="mt-3">Código Postal</label>
            <InputNumber id="cp" @bind-Value="establecimiento.CodigoPostal" class="form-control" />

            <label for="tel" class="mt-3">Teléfono</label>
            <InputText id="tel" @bind-Value="establecimiento.Telefono" class="form-control" />

            <label for="email" class="mt-3">Correo Electrónico</label>
            <InputText id="email" @bind-Value="establecimiento.Email" class="form-control" />
            <ValidationMessage For="@(() => establecimiento.Email)" />
            <div class="text-end">
                <button type="submit" class="btn btn-dark mt-4 align-content-end rounded-0">Agregar</button>
            </div>
        </EditForm>

        <hr />
        <div class="card-header bg-primary text-white text-center mb-3">
            <h5 class="my-1">Carga masiva de establecimientos</h5>
        </div>

        <div class="d-flex align-items-center gap-2 bg-light p-1 overflow-hidden">
            <label class="btn btn-light bg-white rounded-0">
                Seleccionar archivo
                <InputFile OnChange="SeleccionarFichero" accept=".xlsx" class="d-none" />
            </label>
            <span>@(fichero ?? "Sin elección")</span>
        </div>
        @if (mensajeError != null)
        {
            <div class="text-danger mt-2">@mensajeError</div>
        }

        <a class="mt-2" href="files/PlantillaEstablecimientos.xlsx" download>Descargar plantilla Excel</a>

        <div class="text-end mb-3">
            <button type="submit" class="btn btn-dark mt-4 align-content-end rounded-0" @onclick="CargarExcel">Cargar Excel</button>
        </div>

    </renderAlta>

    <renderListado>
          <DataTables>
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th class="nombre-columna text-truncate">Nombre</th>
                            <th>Telefono</th>
                            <th>Email</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var est in establecimientos)
                        {
                            <tr>
                                <td class="nombre-columna text-truncate">@est.Nombre</td>
                                <td>@est.Telefono</td>
                                <td>@est.Email</td>

                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-info me-1" @onclick="@(() => VerDetalle(est.Id))">
                                        <i class="bi bi-search" title="Ver detalles"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning me-1" @onclick="@(() => Editar(est.Id))">
                                        <i class="bi bi-pencil d-inline-block"  style="transform:scaleX(-1);" title="Editar campos"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" @onclick="@(() => Eliminar(est.Id))">
                                        <i class="bi bi-trash" title="Eliminar usuario"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </DataTables>

    </renderListado>

</ListadoAltaTemplate>

