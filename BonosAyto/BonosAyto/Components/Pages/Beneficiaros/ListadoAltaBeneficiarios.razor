@page "/beneficiarios"
@using BonosAytoService.DTOs
@inject NavigationManager Navigate



<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css" rel="stylesheet" />


<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>




<script>
    $(document).ready(function () {
        $('#listaBeneficiarios').DataTable();
    });
</script>


<!--[Título vista]-->
<div class="d-flex justify-content-center my-4">
    <h1 class="text-center">Listado y Alta de Beneficiarios</h1>
</div>


<div class="container">
    <div class="row">

        <div class="col-4 border border-dark">
            <!--Formulario agregar beneficiarios-->
            <h6 class="mb-3 mt-2 text-center">

                Formulario: Agregar Beneficiario
            </h6>

            <EditForm Model="modeloAlta" OnValidSubmit="@AltaBeneficiario">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <label for="nombre">Nombre</label>
                <InputText id="nombre" @bind-Value="modeloAlta.Nombre" class="form-control" />

                <label for="apellido1" class="mt-3">Primer Apellido</label>
                <InputText id="apellido1" @bind-Value="modeloAlta.PrimerApellido" class="form-control" />

                <label for="apellido2" class="mt-3">Segundo Apellido</label>
                <InputText id="apellido2" @bind-Value="modeloAlta.SegundoApellido" class="form-control" />

                <label for="dni" class="mt-3">DNI</label>
                <InputText id="dni" @bind-Value="modeloAlta.DNI" class="form-control" />

                <label for="direccion" class="mt-3">Dirección</label>
                <InputText id="direccion" @bind-Value="modeloAlta.Direccion" class="form-control" />

                <label for="cp" class="mt-3">Código Postal</label>
                <InputNumber id="cp" @bind-Value="modeloAlta.CodigoPostal" class="form-control" />

                <label for="tel" class="mt-3">Teléfono</label>
                <InputText id="tel" @bind-Value="modeloAlta.Telefono" class="form-control" />

                <label for="email" class="mt-3">Correo Electrónico</label>
                <InputText id="email" @bind-Value="modeloAlta.Email" class="form-control" />
                <div class="text-end">
                    <button type="submit" class="btn btn-dark mt-4 align-content-end rounded-0">Agregar</button>
                </div>
            </EditForm>           

            <hr />
            <h6 class="mt-1 text-center">
                Carga masiva de beneficiarios/as
            </h6>
            <div class="d-flex align-items-center gap-2 bg-light p-1">
                <label class="btn btn-light bg-white rounded-0">
                    Seleccionar archivo
                    <InputFile OnChange="SeleccionarFichero" accept=".xlsx" class="d-none" />
                </label>
                <span>@(fichero ?? "Sin elección")</span>
            </div>
            @if (mensajeError != null)
            {
                <div class="text-danger mt-2">@mensajeError</div>
            }

            <a class="mt-2" href="files/PlantillaBeneficiarios.xlsx" download>Descargar plantilla Excel</a>

            <div class="text-end mb-3">
                <button type="submit" class="btn btn-dark mt-4 align-content-end rounded-0" @onclick="CargarExcel">Cargar Excel</button>
            </div>

        </div>
        <div class="col-1"></div>

        <div class="col-7 border border-dark ">
            <!--buscador-->
            <!--

            <div class="m-3">
                <div class="input-group">
                    <button class="btn btn-outline-secondary" type="button" @onclick="FiltrarBeneficiarios"> 
                        <i class="bi bi-search"></i> 
                    </button>
                    <input @bind="searchbar"
                           @bind:event="oninput"
                           class="form-control"
                           placeholder="Buscar beneficiario..." />
                </div>
            </div>
            -->
            <table id="listaBeneficiarios"  class="table">
                <thead class="bg-light ">
                    <tr>
                        <th>Id</th>
                        <th>Nombre</th>
                        <th>Telefono</th>
                        <th>Email</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                
                <tbody>
                    @foreach (var ben in listaBeneficiarios)
                    {
                        <tr>
                            <td>@ben.Id</td>
                            <td>@($"{ben.Nombre} {ben.PrimerApellido} {ben.SegundoApellido}")</td>
                            <td>@ben.Telefono</td>
                            <td>@ben.Email</td>
                            <td>
                                <i class="bi bi-search me-1" @onclick="() => VerDetalle(ben.Id)"></i>
                                <i class="bi bi-pencil me-1 d-inline-block" @onclick="() => Modificar(ben.Id)" style="transform: scaleX(-1);"></i>
                                <i class="bi bi-trash me-1" @onclick="() => Borrar(ben.Id)"></i>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>

    </div>
</div>